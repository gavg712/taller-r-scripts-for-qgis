---
title: "3. Documentando Rscripts para QGIS"
author: "Gabo Gaona & Antony Barja"
date: 2022-06-20T06:00:00-05:00
tags: ["R","QGIS"]
output: 
    html_document:
        number_sections: true
---



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>La documentaci√≥n del software y scripts es una tarea bastante demandada por los usuarios. Las mejores herramientas de software en cualquier campo tienen particular √©nfasis en la documentaci√≥n para el usuario. As√≠ se aseguran que la herramienta se usada por una mayor cantidad de personas.</p>
<p>QGIS y R no son la excepci√≥n. Tienen suficiente documentaci√≥n como sea necesaria para hacerle la vida m√°s f√°cil a sus usuarios. Incluso a nivel de par√°metro, seg√∫n Nyall Dawson (<a href="https://github.com/north-road/qgis-processing-r/pull/104#issuecomment-1028490076">Comentario #104:1028490076</a>):</p>
<blockquote>
<p><em>‚Ä¶hay un movimiento en proveer una mejor ayuda para usuarios de los algoritmos del n√∫cleo de QGIS, agregando tips a los par√°metros individuales de las herramientas, en ese sentido puedo ver que teniendo este soporte en el proveedor de R es una buena cosa</em></p>
</blockquote>
<p>Eso es lo que queremos transmitir con este segundo ejercicio. Proveer al usuario de la informaci√≥n suficiente de c√≥mo usar un script de R para <em>QGIS Processing</em></p>
</div>
<div id="escribiendo-la-ayuda" class="section level2">
<h2>Escribiendo la ayuda</h2>
<p>Sabemos que un script de R para <em>QGIS Processing</em> tiene dos partes fundamentales para ejecutar un proceso: El encabezado y el cuerpo. Sin embargo tambi√©n se puede agregar una tercera secci√≥n de informaci√≥n que permite complementar la herramienta. Esta tercera secci√≥n habitualmente se escribe en un fichero complementario de extensi√≥n <code>rsx.help</code>.</p>
<div id="ficheros-rsx.help" class="section level3">
<h3>Ficheros <code>rsx.help</code></h3>
<p>El archivo de ayuda debe estar ubicado en el mismo directorio y tener el nombre del script, pero con extensi√≥n <code>.rsx.help</code>. El contenido de este archivo es un objeto JSON con las descripciones de los par√°metros.</p>
<p>Por ejemplo, supongamos que hemos a√±adido un fichero script llamado <code>simple_scatterplot.rsx</code> con el siguiente contenido:</p>
<pre class="r"><code>##Example scripts=group
##Scatterplot=name
##output_plots_to_html
##Layer=vector
##X=Field Layer
##Y=Field Layer

# simple scatterplot
plot(Layer[[X]], Layer[[Y]])</code></pre>
<p>El fichero de ayuda deber√≠a ser llamado <code>simple_scatterplot.rsx.help</code> y su contenido m√≠nimo deber√≠a ser:</p>
<pre class="json"><code>{
&quot;Layer&quot;: &quot;Vector Layer&quot;,
&quot;X&quot;: &quot;Field from Layer to be used as x-axis variable&quot;,
&quot;Y&quot;: &quot;Field from Layer to be used as y-axis variable&quot;
}</code></pre>
<p><img src="help-section-1.png" /></p>
<p>Note que la descripci√≥n de cada par√°metro est√° compuesta por un par <code>"clave":"valor"</code> y est√° separado de otros par√°metros por una coma (,). Este fichero ya se podr√≠a usar para la descripci√≥n de la herramienta nueva. Pero a√∫n hay m√°s cosas que podemos usar para darle m√°s valor informativo. Hay unos cuantos par√°metros especiales que no tienen un nombre definido por el autor del script sino por el el complemento como tal. Estos son:</p>
<ul>
<li><code>"ALG_DESC"</code>. Es la descripci√≥n general de la herramienta. Esta se mostrar√° inmediatamente despu√©s del t√≠tulo de la secci√≥n de ayuda.</li>
<li><code>"ALG_VERSION"</code>. Sirve para especificar la versi√≥n del script, especialmente cuando el autor lleva un control de versiones.</li>
<li><code>"ALG_CREATOR"</code>. Es para definir el nombre del autor del script.</li>
<li><code>"ALG_HELP_CREATOR"</code>. Es para definir el nombre de quien escribi√≥ la ayuda del script.</li>
<li><code>"RPLOTS"</code>. Es la descripci√≥n para el gr√°fico de salida en el caso de que el script genere un gr√°fico.</li>
<li><code>"R_CONSOLE_OUTPUT"</code>. Es la descripci√≥n para el fichero log de la consola en el caso de que el script incluya una salida a consola.</li>
</ul>
<p>Cualquiera de estos par√°metros se pueden agregar al JSON del fichero <code>rsx.help</code>, siempre conservando la estructura de <code>"clave":"valor"</code>. Si seguimos con nuestro ejemplo anterior podemos agregar varios de estos par√°metros a la descripci√≥n. As√≠:</p>
<pre class="json"><code>{
&quot;Layer&quot;: &quot;Vector Layer&quot;,
&quot;X&quot;: &quot;Field from Layer to be used as x-axis variable&quot;,
&quot;Y&quot;: &quot;Field from Layer to be used as y-axis variable&quot;,
&quot;RPLOTS&quot;: &quot;Output path for html file with the scatterplot&quot;,
&quot;ALG_DESC&quot;: &quot;This file creates a simple scatterplot from two fields in a vector layer&quot;,
&quot;ALG_CREATOR&quot;: &quot;Name of algorithm creator&quot;,
&quot;ALG_HELP_CREATOR&quot;: &quot;Name of help creator&quot;,
&quot;ALG_VERSION&quot;: &quot;0.0.1&quot;
}</code></pre>
<p><img src="help-section-2.png" /></p>
</div>
<div id="ayuda-como-l√≠neas-del-script" class="section level3">
<h3>Ayuda como l√≠neas del script</h3>
<p>A partir de la versi√≥n 3.2.0 del plugin, tambi√©n es posible introducir la documentaci√≥n como l√≠neas en el propio script. Esto permite prescindir del archivo <code>rsx.help</code>. Para ello, las l√≠neas de documentaci√≥n deben ser escritas con la estructura <code>#' Par√°metro: Descripci√≥n</code> . Veamos c√≥mo ser√≠a usando el ejemplo anterior.</p>
<pre class="json"><code>##Example scripts=group
##Scatterplot=name
##output_plots_to_html
##Layer=vector
##X=Field Layer
##Y=Field Layer

# simple scatterplot
plot(Layer[[X]], Layer[[Y]])

#&#39; Layer: Vector Layer
#&#39; X: Field from Layer to be used as x-axis variable
#&#39; Y: Field from Layer to be used as y-axis variable
#&#39; RPLOTS: Output path for html file with the scatterplot
#&#39; ALG_DESC: This file creates a simple scatterplot from 
#&#39;         : two fields in a vector layer
#&#39; ALG_CREATOR: Name of algorithm creator
#&#39; ALG_HELP_CREATOR: Name of help creator
#&#39; ALG_VERSION: 0.0.1</code></pre>
<p>El resultado se mostrar√° exactamente como cuando se usan los ficheros de ayuda. Adem√°s, n√≥tese que de este modo tambi√©n es posible introducir la descripci√≥n de un par√°metro en varias l√≠neas. Para ello, es necesario continuar las l√≠neas posteriores sin introducir el nombre del par√°metro, as√≠ <code>#' : descripci√≥n adicional</code>.</p>
</div>
</div>
<div id="estructura-y-estilos-con-html." class="section level2">
<h2>Estructura y estilos con HTML.</h2>
<p>En las l√≠neas de ayuda tambi√©n se pueden introducir peque√±os elementos de c√≥digo HTML. √âste ser√° evaluado al momento de ejecutar la herramienta. Desafortunadamente no todas las bodades de html y css pueden ser usadas. Sin embargo algunas cosas funcionar√°n.</p>
<pre class="html"><code>{
&quot;Layer&quot;: &quot;Vector Layer&quot;,
&quot;X&quot;: &quot;A &lt;b&gt;Field&lt;/b&gt; from &lt;em&gt;Layer&lt;/em&gt; to be used as &lt;code style=&#39;background-color: yellow;&#39;&gt;x-axis&lt;/code&gt; variable&quot;,
&quot;Y&quot;: &quot;A &lt;b&gt;Field&lt;/b&gt; from &lt;em&gt;Layer&lt;/em&gt; from Layer to be used as &lt;code style=&#39;background-color: yellow;&#39;&gt;y-axis&lt;/code&gt; variable&quot;,
&quot;RPLOTS&quot;: &quot;&lt;b style=&#39;text-decoration: underline;&#39;&gt;Output path&lt;/b&gt; for html file with the scatterplot&quot;,
&quot;ALG_DESC&quot;: &quot;&lt;p&gt;This file creates a &lt;span style=&#39;text-decoration: underline;&#39;&gt;simple scatterplot&lt;/span&gt; from two fields in a vector layer&lt;/p&gt;&lt;p&gt;Github repository: &lt;a href=&#39;https://github.com/gavg712/taller-r-scripts-for-qgis&#39;&gt;Taller UseR!2022 repo&lt;/a&gt;&quot;,
&quot;ALG_CREATOR&quot;: &quot;&lt;a href=&#39;https://github.com/gavg712&#39;&gt;@gavg712&lt;/a&gt;&quot;,
&quot;ALG_HELP_CREATOR&quot;: &quot;@gavg712&quot;,
&quot;ALG_VERSION&quot;: &quot;0.0.1&quot;
}</code></pre>
<p><img src="help-section-3.png" /></p>
</div>
<div id="ejercicio" class="section level2">
<h2>Ejercicio</h2>
<p>Ahora practicaremos documentando el script del ejercicio anterior. Usted puede elegir el texto descriptivo que mejor le parezca para cada par√°metro del script. Puede incluir tambi√©n uno o varios par√°metros especiales, seg√∫n le convenga. Empecemos!</p>
<ul>
<li>Primero en funci√≥n de qu√© versi√≥n del plugin tiene instalado <strong><em>Processing R Provider</em></strong>, decida qu√© tipo de formato va a usar para su script. Recuerde que la versi√≥n de l√≠neas de documentaci√≥n en el script solo est√° disponible a partir de la versi√≥n 3.2.0 del plugin.</li>
<li>Si va a crear un fichero, abra un fichero de texto nuevo y gu√°rdelo en la carpeta de rscripts del plugin.</li>
<li>Abra ese fichero en modo de edici√≥n con cualquier editor de texto.</li>
<li>Escriba entre llaves <code>{...}</code> la descripci√≥n para cada par√°metro de la herramienta. No olvide poner entre comillas dobles (<code>"</code>) tanto la clave como el valor de cada par√°metro, y una coma (<code>,</code>) para separa cada par√°metro.</li>
<li>Opcionalmente, agregue una descripci√≥n general del algoritmo, el nombre del creador del algoritmo o de la ayuda.</li>
<li>Guarde los cambios y visualice el resultado abriendo el script desde la caja de herramientas de <em>Processing</em></li>
</ul>
{{% notice "warning" "ü§û Ayuda" %}}
El contenido a continuaci√≥n ha sido ocultado intencionalmente. Despli√©galo solo si sientes que no puedes realizar el ejercicio por tu cuenta.
{{% /notice %}}
<details style="margin-bottom:10px;">
<summary>
Haz clic para mostrar el contenido de ayuda.
</summary>
<ul>
<li><p>Opci√≥n 1. Guardar un fichero <code>rsx.help</code> en la misma ubicaci√≥n de los rscripts de processing, con el contenido:</p>
<pre class="json"><code>{
&quot;Capa&quot;: &quot;Una capa vectorial que contenga la variable a graficar&quot;,
&quot;Campo&quot;: &quot;Un campo de la capa de entrada. Este ser√° la &lt;em&gt;variable&lt;/em&gt; a graficar&quot;,
&quot;Transform&quot;: &quot;Opcional. Se puede elegir un m√©todo de transformaci√≥n de la variable.&quot;,
&quot;ALG_DESC&quot;: &quot;Esta herramienta permite crear un gr√°fico que combina un viol√≠n y un boxplot, usando &lt;code style=&#39;color: #dfdfdf;background-color: #2e393d;&#39;&gt;ggplot2&lt;/code&gt;&quot;,
&quot;ALG_CREATOR&quot;: &quot;&lt;Nombre del creador&gt;&quot;,
&quot;ALG_HELP_CREATOR&quot;: &quot;Instructores&quot;,
&quot;ALG_VERSION&quot;: &quot;0.0.1&quot;
}</code></pre></li>
<li><p>Opci√≥n 2. Escribir la documentaci√≥n en el mismo script (solo a partir de la versi√≥n 3.2.0 del plugin).</p>
<pre class="html"><code>#&#39; Capa: Una capa vectorial que contenga la variable a graficar
#&#39; Campo: Un campo de la capa de entrada. Este ser√° la &lt;em&gt;variable&lt;/em&gt; a graficar
#&#39; Transform: Opcional. Se puede elegir un m√©todo de transformaci√≥n de la variable.
#&#39; ALG_DESC: Esta herramienta permite crear un gr√°fico que combina un viol√≠n y un boxplot,
#&#39; :usando &lt;code style=&quot;padding:2px;color: #dfdfdf;background-color: #2e393d;&quot;&gt;ggplot2&lt;/code&gt;
#&#39; ALG_CREATOR: &lt;Nombre del creador&gt;
#&#39; ALG_HELP_CREATOR: Instructores
#&#39; ALG_VERSION: 0.0.1

##Taller UseR!2022=group
##violinandboxplot=name
##Gr√°fico de violin y boxplot=display_name
##Capa=vector
##Campo=Field Capa
##Transform=optional enum boxcox;exp;log;log10;log1p;log2;logit;probability;probit;pseudo_log;reciprocal;reverse;sqrt
##output_plots_to_html

library(ggplot2)
... &lt; RESTO DEL CUERPO &gt;
</code></pre></li>
</ul>
</details>
</div>
